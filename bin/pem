#!/usr/bin/env bash
set -e
[  "$PEM_DEBUG" = "yes" ] && set -x

PEM_DIR=$(dirname "$0")
PEM_EMPTY="pem-empty"

usage() {
    echo "Usage: pem <command>"
    echo "Usage: pem <command> help"
    echo ""
    echo "Available commands are:"
    echo "  help                Display current message."
    echo "  install             Install a version of Python."
    echo "  default             Configure default Python's version."
    echo "  remove              Remove a Python's version."
    echo "  create-dir-env      Configure local Python's environment for current directory."
    echo "  folder-state        Show Python's environment for current folder."
    echo "  clean-dir-env       Clean up Python's environment for current directory."
}

commands() {
    echo "help"
    echo "install"
    echo "default"
    echo "remove"
    echo "create-dir-env"
    echo "folder-state"
    echo "clean-dir-env"
}

main() {
    local COMMAND=${PEM_EMPTY}
    if [ "$1" != "" ]; then
        COMMAND="$1"; shift
    fi
    [ "$COMMAND" = "${PEM_EMPTY}" ] || [ "$COMMAND" = "help" ] && usage && exit 0
    [ "$COMMAND" = "commands" ] && commands && exit 0
    [ ! -e "$PEM_DIR/pem-$COMMAND" ] && echo "Unknown command: pem $COMMAND" && usage && exit 2
    . "$PEM_DIR/pem-common"
    . "$PEM_DIR/pem-$COMMAND"

    local ACTION="default"
    if [ "$1" = "help" ]; then
        ACTION="$1"; shift
    fi
    [ "$ACTION" = "help" ] && usage && exit 0
    if ! type "pem-$ACTION" >/dev/null 2>&1; then
        echo "'$COMMAND': unknown action: '$ACTION'"
        usage       # overloaded usage
        exit 3
    fi
    pem-$ACTION "$@"
}

main "$@"
